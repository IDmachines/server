<div ng-app="registration" ng-controller="regController">
    <script src="http://code.angularjs.org/1.2.0-rc.3/angular.min.js"></script>
    <script>
        var app = angular.module('registration', []);
        app.controller('regController', function($scope, $http){

            $scope.registration = {
                emails : {'primary':'true','value':''}
            };

            $scope.password_validate = '';

            $scope.submitRegistration = function() {
                $http({method: 'POST', url: '$REGISTERLINK',
                    data: $scope.registration, headers: {'Content-Type': 'application/json'}}).
                        success(function(data, status, headers, config) {
                            $scope.status = status
                            $scope.data = data
                        }).
                        error(function(data, status, headers, config) {
                            $scope.status = status
                            $scope.data = data
                        });
            };
        });
        app.directive('match', function($parse) {
            return {
                require: 'ngModel',
                link: function(scope, elem, attrs, ctrl) {
                    scope.$watch(function() {
                        //$parse(attrs.match) defines a method. the parameter 'scope' will be searched for the 'attrs.match' value
                        return $parse(attrs.match)(scope) === ctrl.$modelValue;
                    }, function(currentValue) {
                        ctrl.$setValidity('mismatch', currentValue);
                    });
                }
            }
        });
    </script>
    <h1>Registrierung</h1>
    <hr>
    <form name="form" class="css-form" novalidate>
        <table>
            <tr>
                <td>
                    <label>E-Mail Adresse*</label>
                </td>
                <td>
                    <input type="email" name="email" ng-model="registration.userName" ng-change="registration.emails.value=registration.userName" required/>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Vorname*</label>
                </td>
                <td>
                    <input type="text" name="vorname" ng-model="registration.name.givenName" required>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Nachname*</label>
                </td>
                <td>
                    <input type="text" name="nachname" ng-model="registration.name.familyName" required>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Passwort* (8 Zeichen)</label>
                </td>
                <td>
                    <input type="password" name="pw" ng-model="registration.password" ng-minlength=8 required>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Passwort wiederholen*</label>
                </td>
                <td>
                    <input type="password" name="pw2" ng-model="password_validate" match="registration.password" required>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Namenszusatz*</label>
                </td>
                <td>
                    <input type="text" name="namenszusatz" ng-model="registration.name.honorificSuffix" required>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Anrede*</label>
                </td>
                <td>
                    <input type="text" name="anrede" ng-model="registration.name.honorificPrefix" required>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Geburtsname*</label>
                </td>
                <td>
                    <input type="text" name="gebname" ng-model="registration.geburtsName" required>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Geburtsdatum*</label>
                </td>
                <td>
                    <input type="text" name="gebdatum" ng-model="registration.geburtsDatum" required>
                </td>
            </tr>
            <tr>
                <td>
                    <label>Stipendium*</label>
                </td>
                <td>
                    <input type="text" ng-model="registration.stipfoetyp" required>
                </td>
            </tr>
            <tr>
                <td>
                    <label>EV Erklaerung*</label>
                </td>
                <td>
                    <input type="text" name="stipendium" ng-model="registration.evErklaerung" required>
                </td>
            </tr>
            <tr>
                <td/>
                <td>
                    <button name="speichernBtn" ng-click='submitRegistration()' ng-disabled="form.$invalid" >Speichern</button>
                </td>
            </tr>
        </table>
        <hr>
    </form>
    <style type="text/css">
        .css-form input.ng-invalid.ng-dirty {
            background-color: #FA787E;
        }

        .css-form input.ng-valid.ng-dirty {
            background-color: #78FA89;
        }
        input {
            margin-left: 30%;
        }
        button {
            margin-left: 30%;
        }
    </style>
</div>